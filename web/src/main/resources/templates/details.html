
<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <title th:text="${externalId}"></title>
    <meta name="description" content="PDX Finder" /><!-- Describe what this page is about -->
    <meta name="keywords" content="Framework, Life Sciences" /><!-- A few keywords that relate to the content of THIS PAGE (not the whole project) -->
    <meta name="author" content="PDX Finder" />
    <meta name="HandheldFriendly" content="true" />
    <meta name="MobileOptimized" content="width" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <link rel="apple-touch-icon" sizes="180x180" href="https://ebiwd.github.io/pdx-visual-framework/images/favicons/apple-touch-icon.png?v=1">
    <link rel="icon" type="image/png" sizes="32x32" href="https://ebiwd.github.io/pdx-visual-framework/images/favicons/favicon-32x32.png?v=1">
    <link rel="icon" type="image/png" sizes="16x16" href="https://ebiwd.github.io/pdx-visual-framework/images/favicons/favicon-16x16.png?v=1">
    <link rel="manifest" href="https://ebiwd.github.io/pdx-visual-framework/images/favicons/manifest.json?v=1">
    <link rel="mask-icon" href="https://ebiwd.github.io/pdx-visual-framework/images/favicons/safari-pinned-tab.svg?v=1" color="#0032a0">
    <link rel="shortcut icon" href="https://ebiwd.github.io/pdx-visual-framework/images/favicons/favicon.ico?v=1">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css">
    <meta name="apple-mobile-web-app-title" content="PDX Finder">
    <meta name="application-name" content="PDX Finder">
    <meta name="msapplication-config" content="https://ebiwd.github.io/pdx-visual-framework/images/favicons/browserconfig.xml?v=1">
    <meta name="theme-color" content="#0032a0">
    <!-- If you link to any other sites frequently, consider optimising performance with a DNS prefetch -->
    <!-- <link rel="dns-prefetch" href="//www.ebi.ac.uk" /> -->

    <!-- CSS: implied media=all -->
    <!-- CSS concatenated and minified via ant build script-->

    <!-- <link rel="stylesheet" href="https://dev.ebi.emblstatic.net/web_guidelines/EBI-Framework/v1.3/css/ebi-global.css" type="text/css" media="all" /> -->
    <link rel="stylesheet" href="https://dev.ebi.emblstatic.net/web_guidelines/EBI-Icon-fonts/v1.2/fonts.css" type="text/css" media="all" />
    <!-- Import Choice Library stylesheet-->
    <link rel="stylesheet" href="https://ebi.emblstatic.net/web_guidelines/EBI-Framework/v1.2/libraries/Choices/assets/styles/css/choices.min.css">
    <!-- Use this CSS file for any custom styling -->
    <!--    <link rel="stylesheet" href="https://raw.githubusercontent.com/ebiwd/pdx-visual-framework/master/css/app.min.css" type="text/css" media="all" /> -->
    <link rel="stylesheet" th:href="@{/css/app.min.css}" type="text/css" media="all"/>

    <link rel="stylesheet" th:href="@{/css/customStyles.css}" type="text/css" media="all"/>

    <!-- If you have a custom header image or colour -->
    <!--
    <meta name="ebi:masthead-color" content="#000" />
    <meta name="ebi:masthead-image" content="//www.ebi.ac.uk/web_guidelines/EBI-Framework/images/backgrounds/embl-ebi-background.jpg" />
    -->

    <!-- you can replace this with theme-[projectname].css. See http://www.ebi.ac.uk/web/style/colour for details of how to do this -->
    <!-- also inform ES so we can host your colour palette file -->
    <!-- <link rel="stylesheet" href="https://dev.ebi.emblstatic.net/web_guidelines/EBI-Framework/v1.3/css/theme-embl-petrol.css" type="text/css" media="all" /> -->
    <!-- end CSS-->

    <style>
        .tooltip {
            max-width: none;
        }

        table.datatable-pdx thead th {
            font-size: 1.0rem;
        }

        table.datatable-pdx td {
            font-size: 0.9rem;
        }

        h4 {
            font-size: 1.0rem;
        }

        ul.pdx-accordion-1 a.accordion-title {
            font-size: 1.0rem;
        }

        ul.pdx-accordion-2 a.accordion-title {
            font-size: 0.95rem;
        }

        span.selected {
            color: #06369d;
            font-weight: bold;
        }


    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script th:src="@{/js/jquery.dataTables.js}"></script>
    <script th:src="@{/js/scroller.js}"></script>
</head>

<body class="level2">

<div content="content-wrapper">
    <div id="skip-to">
        <a href="#content">Skip to main content</a>
    </div>

    <div id="content">


        <!--/*/ <th:block th:include="fragments/shared :: menu"></th:block> /*/-->

        <!-- Suggested layout containers -->
        <section id="main-content-area" role="main">

            <div class="row">
                <nav aria-label="You are here:" role="navigation">
                    <ul class="breadcrumbs columns">
                        <li><a href="/">Home</a></li>
                        <li>
                            Details
                        </li>
                        <li>
                            <span class="show-for-sr">Current: </span> <span th:text="${externalId}">Model ID</span>
                        </li>
                    </ul>
                </nav>
            </div>

            <!-- Three Grids Section -->
            <section>
                <div class="row">

                    <div class="columns medium-4 small-12 margin-top-30">
                        <h4 class="block-title clearfix"><span class="float-left border-color-black" th:text="${externalId}"></span></h4>

                    </div>

                    <div class="columns medium-4 small-12 margin-top-30">
                        <ul class="cols-2 margin-top-large">
                            <li><span th:text="${mappedOntology}"></span> </li>


                        </ul>
                    </div>

                    <div class="columns medium-4 small-12 margin-top-30">
                        <!--
                        <p><span class="badge"><i class="icon icon-functional" data-icon="L"></i></span> <a href="#" class="font-style-underline">Show similar</a></p>
                        <p><span class="badge"><i class="icon icon-functional" data-icon="+"></i></span> <a href="#" class="font-style-underline">Add to my list</a></p>
                        <p><span class="badge"><i class="icon icon-functional" data-icon="="></i></span> <a href="#" class="font-style-underline">Download report</a></p>
                         -->
                        <p><a href="#" class="button more uppercase margin-top-large" disabled="disabled">Contact Provider</a></p>
                    </div>
                </div>
            </section>

              <hr class="margin-vertical-30">

              <!-- Tabs Section -->
            <section class="row">
                <ul class="tabs style-2" data-tabs id="example2-tabs">
                    <li class="tabs-title"><a href="#summary" data-tabs-target="summary">Summary</a></li>
                    <li class="tabs-title is-active"><a href="#variation" data-tabs-target="variation" id="variation_data_link" aria-selected="true">Variation</a></li>
                    <li class="tabs-title"><a href="#plots" data-tabs-target="plots">Dosing studies</a></li>
                </ul>

                <div class="tabs-content style-2" data-tabs-content="example2-tabs">
                    <div class="tabs-panel" id="summary">


                            <!-- Summary first row -->
                        <div class="row">

                        <div class="columns medium-6 small-12 margin-top-30">
                            <div class="responsive-table">
                                <table class="unstriped pdx-table head-left">
                                    <thead>
                                        <tr>
                                            <th colspan="2"> Patient</th>
                                        </tr>
                                    </thead>
                                    <tbody>

                                    <tr><th class="text-left">Gender</th>     <td th:text="${gender}"></td></tr>
                                    <tr><th class="text-left">Age</th>        <td th:text="${age}"></td></tr>
                                    <tr><th class="text-left">Race / Ethnicity</th>      <td><span th:text="${race}"></span> / <span th:text="${ethnicity}"></span> </td></tr>
                                    <tr th:if="${not #lists.isEmpty(relatedModels)}"><th class="text-left">Related models</th>        <td><span th:each="relMod:${relatedModels}"><a th:text="${relMod}" th:href="@{'/pdx/'+${dataSrc}+'/'+${relMod}}"></a> </span></td></tr>
                                    </tbody>
                                </table>
                            </div>

                        </div>

                        <div class="columns medium-6 small-12 margin-top-30">
                            <div class="responsive-table">
                                <table class="unstriped pdx-table head-left">
                                    <thead>
                                    <tr>
                                        <th colspan="2"> Patient Tumor</th>
                                    </tr>
                                    </thead>
                                    <tbody>

                                    <tr><th class="text-left">Histology</th>                  <td><span th:text="${diagnosis}"></span> <i class="hdc" th:text="${' (mapped to: '+mappedOntology+')'}"></i> </td></tr>
                                    <tr><th class="text-left">Ontology Mapping</th>           <td th:text="${mappedOntology}"></td></tr>
                                    <tr><th class="text-left">Primary Tissue</th>             <td th:text="${originTissue}"></td></tr>
                                    <tr><th class="text-left">Collection Site</th>          <td th:text="${sampleSite}"></td></tr>
                                    <tr><th class="text-left">Tumor Type</th>                 <td th:text="${tumorType}"></td></tr>
                                    <tr><th class="text-left">Stage / Grade</th>             <td th:text="${classification}"></td></tr>
                                    </tbody>
                                </table>
                            </div>

                        </div>


                        </div> <!-- Summary first row ends-->

                        <div class="row"><!-- Summary second row -->

                            <div class="columns medium-6 small-12 margin-top-30">
                                <div class="responsive-table">
                                    <table class="unstriped pdx-table head-left">
                                        <thead>
                                        <tr>
                                            <th colspan="2">PDX model</th>
                                        </tr>
                                        </thead>
                                        <tbody>

                                        <tr><th class="text-left">Strain</th><td th:text="${strain}"></td></tr>
                                        <tr><th class="text-left">Engraftment Site</th><td th:text="${engraftmentSite}"></td></tr>
                                        <tr><th class="text-left">Implantation Type</th><td th:text="${sampleType}"></td></tr>
                                        </tbody>
                                    </table>
                                </div>

                            </div>

                            <div class="columns medium-6 small-12 margin-top-30">
                                <div class="responsive-table">
                                    <table class="unstriped pdx-table head-left">
                                        <thead>
                                        <tr>
                                            <th colspan="2">Model quality control</th>
                                        </tr>
                                        </thead>
                                        <tbody>

                                        <tr>
                                            <th class="text-left">Technology</th>
                                            <td th:text="${fullData.technology}"></td>
                                        </tr>
                                        <tr>
                                            <th class="text-left">Description</th>
                                            <td th:text="${fullData.description}"></td>
                                        </tr>
                                        <tr>
                                            <th class="text-left">Passages</th>
                                            <td th:text="${fullData.passages}"></td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>

                            </div>

                        </div>


                    </div>


                    <div class="tabs-panel is-active" id="variation">

                        <p>
                            <style> table *{ -webkit-box-sizing:content-box; -moz-box-sizing:content-box; box-sizing:content-box;}</style>
                        <div class="col-md-12 javaScriptBrowser">

                            <!-- <div class="panel panel-info" th:if="${totalRecords > 0}" >
                                <div class="panel-heading">
                                    <h3 class="panel-title">PDX model studies - <span th:text="${totalRecords}"></span> entries</h3>
                                </div>
                            </div> -->
                </div>

                <!-- Start of Patient variation data -->
                            <div class="tab" role="tabpanel" th:if="${patientInfo.size() > 0}" >
                                <!-- Nav tabs -->
                                <ul class="nav nav-tabs" role="tablist">
                                    <li th:each="technology,iter : ${patientInfo}"
                                        th:class="( ${iter.index} == 0 ) ? 'active' : '' "
                                        role="presentation">

                                        <a th:href="@{'#'+${technology.key}}"
                                           th:text="${technology.key}+' Platform'" role="tab" data-toggle="tab" onclick="showTabs()"> TAB TITLES </a>

                                    </li>
                                </ul>


                                <!-- Tab panes -->
                                <div class="tab-content">
                                    <div th:each="technology,iter : ${patientInfo}"
                                         th:id="${technology.key}"
                                         class="tab-pane active"  role="tabpanel">

                                                <span>
                                                        <div class="table-responsive" th:classappend="( ${iter.index} == 0 ) ? 'showContent' : 'hideContent' ">

                                                            <h4 class="bLine">
                                                                <span class="hdc">Tumor Type: </span>            <i>Patient Tumor</i>                  &nbsp; &nbsp;
                                                                <span class="hdc">Histology:</span> <i th:text="${#strings.capitalize(diagnosis)}"></i>     &nbsp; &nbsp;
                                                                <span class="hdc">Grade: </span>  <i></i>
                                                            </h4>

                                                            <table id="pdxFinder-grid"
                                                                    class="unstriped pdx-table"> <!-- table-striped table-borderedPdx table-hover -->

                                                                <thead>
                                                                <tr>
                                                                    <th>Sample </th>
                                                                    <th>Platform(s)</th>
                                                                    <th>Chromosome</th>
                                                                    <th>Seq. Position</th>
                                                                    <th>Ref. Allele</th>
                                                                    <th>Alt. Allele</th>
                                                                    <th>Consequence</th>
                                                                    <th>Gene</th>
                                                                    <th>Amino Acid Change</th>
                                                                    <th>Read Depth</th>
                                                                    <th>Allele Freq.</th>
                                                                    <th>RS Variants</th>
                                                                </tr>
                                                                </thead>
                                                            </table>
                                                        </div>

                                                </span>

                                    </div>
                                </div>

                            </div>
                <!-- End of Patient Variation Data -->





                <!-- Start of Xenograft Variation data-->

                            <div class="tab" role="tabpanel" th:if="${modelInfo.size() > 0}">

                                <ul class="tabs" data-tabs id="example-tabs" >

                                    <li th:each="technology,iter : ${modelInfo}"
                                        class="tabs-title" th:classappend="( ${iter.index} == 0 ) ? 'is-active' : '' ">

                                        <a th:href="@{'#'+${technology.key}}"
                                           data-th-attr="data-tabs-target=${technology.key},  aria-selected=( ${iter.index} == 0 ) ? 'true' : '' "
                                           th:text="${technology.key}+' Platform'" > TAB TITLES </a>

                                    </li>

                                </ul>


                                <!-- Tab panes -->
                                <div class="tabs-content"  data-tabs-content="example-tabs">
                                    <div th:each="technology,iter : ${modelInfo}"
                                         th:id="${technology.key}"
                                         class="tabs-panel"  th:classappend="( ${iter.index} == 0 ) ? 'is-active' : '' ">

                                                    <span th:unless="${technology.value.size()<1}" th:each="num: ${#numbers.sequence(1,technology.value.size())}"> <!--/* Unable to capture index for inner loop so, this was used for innerloop : <tr th:each="passageList : ${technolog[y.value]}"> */-->

                                                            <div class="table-responsive">

                                                                <h4 class="bLine" th:classappend="( ${num} == 1 ) ? '' : 'topSpace50' ">
                                                                    <span class="hdc">Tumor Type: </span>            <i class="black">Xenograft Tumor</i>                  &nbsp; &nbsp;
                                                                    <span class="hdc">Histology:</span> <i class="black" th:text="${#strings.capitalize(diagnosis)}"></i>     &nbsp; &nbsp;
                                                                    <span class="hdc">Passage: </span>  <i class="black" th:text="${technology.value[num-1]}"></i>
                                                                </h4>

                                                                <table th:id="'pdxFinder-grid'+${#strings.replace(technology.key,' ','-')}+${num}"
                                                                       id="example-datatable"
                                                                       class="table display datatable-pdx table-borderedPdx" th:height="50"> <!-- class=" "   table-condensed style="border:1px solid #000; padding:10px;"-->

                                                                    <thead>
                                                                    <tr>
                                                                        <th>Sample </th>
                                                                        <th>Platform(s)</th>
                                                                        <th>Chromosome</th>
                                                                        <th>Seq. Position</th>
                                                                        <th>Ref. Allele</th>
                                                                        <th>Alt. Allele</th>
                                                                        <th>Consequence</th>
                                                                        <th>Gene</th>
                                                                        <th>Amino Acid Change</th>
                                                                        <th>Read Depth</th>
                                                                        <th>Allele Freq.</th>
                                                                        <th>RS Variants</th>
                                                                    </tr>
                                                                    </thead>
                                                                </table>
                                                            </div>

                                                    </span>

                                    </div>
                                </div>

                            </div>
                        <!-- End of Xenograft Variation data -->


                        </div>

                        </p>
                    </div>


                    <div class="tabs-panel" id="plots">
                        <p></p>
                    </div>

                </div>
            </section>

        </section>
        <!-- Optional local footer (insert citation / project-specific copyright / etc here -->
        <!--
        <footer id="local-footer" class="local-footer" role="local-footer">
          <div class="row">
            <span class="reference">How to reference this page: ...</span>
          </div>
        </footer>
        -->
        <!-- End optional local footer -->
    </div>
    <!-- End suggested layout containers / #content -->


    <!--/*/ <th:block th:include="fragments/shared :: footer"></th:block> /*/-->


</div>
<!-- JavaScript -->

<script src="https://ebi.emblstatic.net/web_guidelines/EBI-Framework/v1.2/libraries/Choices/assets/scripts/dist/choices.min.js"></script>
<script src="https://wwwdev.ebi.ac.uk/web_guidelines/EBI-Framework/v1.3/libraries/foundation-6/js/foundation.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jQuery.highlightRegex/0.1.2/highlightRegex.min.js"></script>
<script th:src="@{/js/script.js}"></script>
<!--<script th:src="@{/js/main.js}"></script>-->



<script type="text/javascript" language="javascript" th:inline="javascript">

    var searchStates = [[ ${mappedTerm} ]];


    function constructSearchOptions(data) {
        var newOptions = [];
        for (var i = 0; i < data.length; i++) {
            newOptions.push({'value':data[i],'label':data[i],selected: false,disabled: false})
        }
        return newOptions;
    }
    /*
    // Test choices integration
    const mainSearch = new Choices('#query', {
        choices: constructSearchOptions(searchStates),
        removeItemButton: true,
        // placeholder: false,
        // placeholderValue: 'This is a placeholder',
        maxItemCount: 1,
        searchFloor: 0,
        searchResultLimit: 10,
        noResultsText: 'No results found',
        fuseOptions: {
            threshold: 0.1,
            // includeScore: true,
            // includeMatches: true, //doesn't do anything as it's not integrated :(
            tokenize: true,
            distance: 1000
        }
    });
    function conditionallyShowDropdown(str) {
        if (str.length < 1) {
            mainSearch.hideDropdown();
        } else {
            mainSearch.showDropdown();
        }
    }
    function regexEscape(str) {
        return str.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&')
    }
    */

    /*
    mainSearch.passedElement.addEventListener('showDropdown', function(event) {
        if (mainSearch.currentState.items.length) {
            if (mainSearch.currentState.items[mainSearch.currentState.items.length-1].active) {
                // only show dropdown if something hasn't been selected
                mainSearch.hideDropdown();
                // hide placeholder text
                $('.main-search .choices__input').attr("placeholder","  ");
                // $('.choices__input').hide();
            }
        } else {
            // show placeholder text
            $('.main-search .choices__input').attr("placeholder","Search (e.g. Melanoma)");
            // show dropdown if nothing selected and a long enough string entered
            conditionallyShowDropdown(mainSearch.currentValue);
        }
    }, false);
    mainSearch.passedElement.addEventListener('search', function(event) {
        var currentSearch = mainSearch.currentValue;
        // highlight match, docs:
        // https://github.com/jbr/jQuery.highlightRegex
        $('.main-search .choices__list--dropdown').highlightRegex(); //clear
        $('.main-search .choices__list--dropdown').highlightRegex(new RegExp(regexEscape(currentSearch),'ig'), {
            tagType:   'span',
            className: 'search-highlight'
        });
        conditionallyShowDropdown(currentSearch);
    }, false);
    mainSearch.passedElement.addEventListener('choice', function(event) {
        // Hide form after selecting an option
        mainSearch.hideDropdown();
        // hide placeholder text
        $('.main-search .choices__input').attr("placeholder","  ");
        // drop the parenthetical
        $('.main-search .choices__list .choices__item').text('test')
        // To autosubmit on select
        // $('form.main-search').submit();
    }, false);
    mainSearch.passedElement.addEventListener('removeItem', function(event) {
        // show placeholder text
        $('.main-search .choices__input').attr("placeholder","Search (e.g. Melanoma)");
    }, false);

*/


    document.getElementsByClassName("javaScriptBrowser")[0].style.display = "block";
    //document.getElementsByClassName("javaScriptBrowser")[1].style.display = "block";
    var modelId = [[${externalId}]];
    var dataSrc = [[${dataSrc}]];
    jQuery(document).ready(function() {
        console.log("ready");
        var modelInfo = [[${modelInfo}]];
        var apiURL = "/data/patientdata/"+dataSrc+"/"+modelId;


        drawTable("pdxFinder-grid",apiURL);
        for (var tech in modelInfo){
            //console.log(tech);

            var counter=1;
            for (var passage in modelInfo[tech]){
                //console.log(modelInfo[tech][passage]);
                var dTech = tech.replace(" ", "-");
                //console.log(dTech);
                apiURL = "/data/modeldata/"+dataSrc+"/"+modelId+"?platform="+tech+"&passage="+modelInfo[tech][passage];
                var tableId = "pdxFinder-grid"+dTech+counter;
                drawTable(tableId,apiURL);
                //console.log(tableId);
                console.log(apiURL);
                counter++;
            }

        }
    } );
    // We define the function
    function drawTable(tableId,apiURL) {

        var l = jQuery("#tableId tr").length;
        console.log(tableId + " " + l);

        var dataTable = $('#' + tableId).DataTable({
            iDisplayLength: 10,
            serverSide: true,
            ajax: {
                url: apiURL, // json datasource
                type: "post",  // method  , by default get

                error: function () {  // error handling
                    $(".pdxFinder-grid-error").html("");
                    $("#" + tableId).append('<tbody class="pdxFinder-grid-error"><tr><th colspan="3">No data found in the server</th></tr></tbody>');
                    $("#pdxFinder-grid_processing").css("display", "none");
                }
            },

            dom: "frtiS",
            scrollY: 300,
            scrollX: true,
            deferRender: true,
            responsive: true,
            bAutoWidth: true,
            scrollCollapse: true,
            scroller: {
                loadingIndicator: true,
                rowHeight: 30
            }

        });

        $(window).bind('resize', function () {
            dataTable.fnAdjustColumnSizing();
        } );
    }




    function showTabs() {
        for (var i=0; i<5; i++) {
            document.getElementsByClassName("hideContent")[i].style.position = "static";
        }
    }
</script>

<!-- <script src="https://wwwdev.ebi.ac.uk/web_guidelines/EBI-Framework/v1.3/js/foundationExtendEBI.js"></script> -->
<!-- <script type="text/JavaScript">$(document).foundationExtendEBI();</script> -->

<!-- Google Analytics details... -->
<!-- Change UA-XXXXX-X to be your site's ID -->
<!-- <script type="text/javascript">!function(e,a,n,t,i,o,c){e.GoogleAnalyticsObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,o=a.createElement(n),c=a.getElementsByTagName(n)[0],o.async=1,o.src="//www.google-analytics.com/analytics.js",c.parentNode.insertBefore(o,c)}(window,document,"script",0,"ga"),ga("create","UA-629242-1",{cookieDomain:"auto"}),ga("require","linkid","linkid.js"),ga("set","anonymizeIp",!0),ga("send","pageview");</script> -->
</body>
</html>
